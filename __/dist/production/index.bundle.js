!function(t,e){for(var n in e)t[n]=e[n]}(this,function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){!function(){t.exports=this.React}()},function(t,e,n){var i=znui.React||n(0);t.exports=i.createClass({displayName:"Link",getDefaultProps:function(){return{highLightStyle:{stroke:"#f0ad4e",strokeWidth:"1px"},lineStyle:{stroke:"#D0E4FF",strokeWidth:"1px"}}},getInitialState:function(){return{uuid:this.props.id||zn.uuid(),x1:0,y1:0,x2:0,y2:0,marker:"",lineStyle:this.props.lineStyle,svgStyle:{},zIndex:0}},componentDidMount:function(){this.highLight(!1),this.props.onLinkDidMount&&this.props.onLinkDidMount(this)},setTarget:function(t){t&&(this._target=t,t.setLink(this.state.uuid,this))},setSource:function(t){t&&(this._source=t,t.setLink(this.state.uuid,this))},getId:function(){return this.state.uuid},reset:function(t,e){var n=this.__calculateSVGBound(t,e);n&&(0==n.left&&0==n.top&&(n.width=0,n.height=0),this.setState({svgStyle:n}))},__getDirection:function(t,e,n,i){var s=0;e=e-i<=0?e:i;return(t=t-n<=0?t:n)!=n&&e!=i&&(s=1),t==n&&e!=i&&(s=2),t==n&&e==i&&(s=3),t!=n&&e==i&&(s=4),s},highLight:function(t){var e={};e=t?this.props.highLightStyle:this.props.lineStyle,this._highLight=t,this.setState({lineStyle:e})},__calculateSVGBound:function(t,e){var n=t||!!this._target&&this._target.getCenterXY(),i=e||!!this._source&&this._source.getCenterXY();if(n&&i){var s=this.props.minSize||10,o=0,r=0,a=0,d=0,h=0,u=0,c=0,p=0;switch(this.__getDirection(n.x,n.y,i.x,i.y)){case 1:o=n.x,r=n.y,(a=i.x-n.x)<s&&(a=s),(d=i.y-n.y)<s&&(d=s),h=0,u=0,c=a,p=d;break;case 2:o=i.x,r=n.y,(a=n.x-i.x)<s&&(a=s),(d=i.y-n.y)<s&&(d=s),h=0,u=d,c=a,p=0;break;case 3:o=i.x,r=i.y,(a=n.x-i.x)<s&&(a=s),(d=n.y-i.y)<s&&(d=s),h=0,u=0,c=a,p=d;break;case 4:o=n.x,r=i.y,(a=i.x-n.x)<s&&(a=s),(d=n.y-i.y)<s&&(d=s),h=0,u=d,c=a,p=0}return this.setState({x1:h,y1:u,x2:c,y2:p}),{left:o,top:r,width:a,height:d}}},drawLineArrow:function(t,e,n,i){var s,o,r,a,d,h;return o=Math.atan2(e-i,t-n),r=Math.cos(o),a=Math.sin(o),s="M"+t+","+e+" L"+n+","+i,s+=" M"+(d=(Number(t)+Number(n))/2)+","+(h=(Number(e)+Number(i))/2),s+=" L"+(Number(d)+Number(10*r-5*a))+","+(Number(h)+Number(10*a+5*r)),s+=" M"+(Number(d)+Number(10*r+5*a))+","+(Number(h)-Number(5*r-10*a)),s+=" L"+d+","+h},__getPath:function(){var t=this.state;return"M"+t.x1+","+t.y1+" L"+(t.x1+t.x2)/2+","+(t.y1+t.y2)/2+" L"+t.x2+","+t.y2},render:function(){return i.createElement("svg",{className:"zr-graph-link",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:znui.react.style(this.state.svgStyle)},i.createElement("marker",{id:"ancestor-arrow",markerUnits:"strokeWidth",markerWidth:"12",markerHeight:"12",viewBox:"0 0 12 12",refX:"35",refY:"6",orient:"auto"},i.createElement("path",{d:"M2,2 L12,6 L2,10 L4,6 L2,2",fill:"#38f"})),i.createElement("path",{className:"line ancestor root",d:this.__getPath(),markerMid:"url(#ancestor-arrow)",style:this.state.lineStyle}))}})},function(t,e,n){var i=znui.React||n(0);n(1);t.exports=i.createClass({displayName:"Node",getDefaultProps:function(){return{draggable:!0,editable:!0,data:{},x:0,y:0}},getInitialState:function(){return this._links={},this._nodes={},{uuid:this.props.id||zn.uuid(),highLight:!1}},componentDidMount:function(){var t=this._dom;this._x=this.props.x,this._y=this.props.y,this._parentPosition=zn.dom.getPosition(this._dom.parentNode),this.props.draggable&&zn.draggable.create(t,{start:[this.props.x,this.props.y],onDragStart:this.__onNodeDragStart,onDrag:this.__onNodeDrag,onDragEnd:this.__onNodeDragEnd}),zn.dom.on(t,"mouseover",this.__onMouseOver),zn.dom.on(t,"mouseout",this.__onMouseOut),this.props.onNodeDidMount&&this.props.onNodeDidMount(this)},getCenterXY:function(){var t=zn.dom.getPosition(this._dom),e=t.width/2,n=t.height/2,i=0,s=0;return this.props.draggable?(i=this._x+e,s=this._y+n,this.props.parent&&(i+=this.props.parent._x,s+=this.props.parent._y)):(i=t.x-this._parentPosition.x+e,s=t.y-this._parentPosition.y+n),{x:i,y:s}},setLink:function(t,e){this._links[t]=e},getLink:function(t){return this._links[t]},deleteLink:function(t){this._links[t]=null,delete this._links[t]},setNode:function(t,e){this._nodes[t]=e},addNode:function(t){var e=null;t&&(e=i.createElement(Node,t),this._nodes[e.state.uuid]=e,i.render(e,this._dom))},__onNodeDragStart:function(t,e){var n=this._dom;if(this._oldZIndex=n.style.zIndex,n.style.zIndex=10,this._startVector={x:e.mouseX,y:e.mouseY},-1!=t.target.className.indexOf("manual-connect"))return this.__createLine(t,e),!1},__createLine:function(t,e){if(!this._dragTemp){var n=this,i=this._dragTemp=document.createElement("div");i.className="zr-graph-node-line-temp",zn.dom.setStyles(this._dragTemp,{width:8,height:8,borderRadius:5,backgroundColor:"#800010"});var s=this.getCenterXY(),o=zn.dom.getPosition(t.target),r=this._parentPosition,a=this.props.canvas.refs.temp;zn.draggable.create(this._dragTemp,{event:t,start:[o.x,o.y],onDragStart:function(t,e){},onDrag:function(t,e){var n=zn.dom.getPosition(i);a.reset(s,{x:n.x-r.x,y:n.y-r.y})},onDragEnd:function(t,e){n.clearTempLink();var i=n.findNode.call(n,document.elementFromPoint(e.mouseX,e.mouseY));i?i!==n.getId()&&n.props.canvas.addLink(n.getId(),i):n.props.onNodeEditDragEnd&&n.props.onNodeEditDragEnd(n,e)}}),document.body.appendChild(this._dragTemp)}},findNode:function(t){if(t&&t!==document.body){var e=t.className;if(!e)return this.findNode(t.parentNode);if("zr-graph-flow-canvas"!=e&&e.indexOf)return-1!==e.indexOf("zr-graph-node")?t.getAttribute("data-id"):this.findNode(t.parentNode)}},clearTempLink:function(){this._dragTemp&&(document.body.removeChild(this._dragTemp),this._dragTemp=null),this.props.canvas.refs.temp.reset({x:0,y:0},{x:0,y:0})},__onConnectMouseUp:function(){this.clearTempLink()},__onNodeDragEnd:function(t,e){var n=Math.abs(this._startVector.x-e.mouseX),i=Math.abs(this._startVector.y-e.mouseY);if(this._dom&&(this._dom.style.zIndex=this._oldZIndex),n<5&&i<5)return this.props.onClick&&this.props.onClick(t,this),!1;this.props.onNodeDragEnd&&this.props.onNodeDragEnd(t,e,this)},__onNodeDrag:function(t,e){this._x=e.currX,this._y=e.currY,this.__onLinkReset(),this.__scanChild(),this.onNodeDrag&&this.onNodeDrag(t,e)},__onLinkReset:function(){var t=this._links;for(var e in t)t[e].reset()},__scanChild:function(){var t=this._nodes;for(var e in t)t[e].__onLinkReset()},highLight:function(t){this.setState({highLight:void 0===t||t})},__onMouseOver:function(t){for(var e in this._links)this._links[e].highLight(!0)},__onMouseOut:function(t){for(var e in this._links)this._links[e].highLight(!1);this.setState({highLight:!1})},__editableRender:function(){if(this.props.editable)return i.createElement("i",{className:"manual-connect",onMouseUp:this.__onConnectMouseUp})},__onDomClick:function(t){},__onContextMenu:function(t){return t.stopPropagation(),this.props.onContextMenu&&this.props.onContextMenu(t,this)},getId:function(){return this.state.uuid},render:function(){var t=this;return i.createElement("div",{ref:function(e){return t._dom=e},style:this.props.style,className:znui.react.classname("zr-graph-node",this.props.className),"data-id":this.getId(),"data-highlight":this.state.highLight,"data-selected":this.props.selected,onClick:this.__onDomClick,onContextMenu:this.__onContextMenu},this.props.render&&this.props.render(this.props.data,this),this.__editableRender())}})},function(t,e,n){t.exports={Node:n(2),Link:n(1),FlowCanvas:n(4)}},function(t,e,n){function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var s=znui.React||n(0),o=znui.ReactDOM||n(5),r=n(2),a=n(1);t.exports=s.createClass({displayName:"FlowCanvas",getInitialState:function(){return{nodes:[],links:[]}},componentDidMount:function(){this._dom=o.findDOMNode(this),this.setData(this.props.data),this.__initDragDrop(this._dom)},componentDidUpdate:function(t,e){t.data!=this.props.data&&this.setData(this.props.data)},__initDragDrop:function(t){t.ondragover=function(t){return t.preventDefault(),this.props.onDragOver&&this.props.onDragOver(t),!0}.bind(this),t.ondragenter=function(t){return this.props.onDragEnter&&this.props.onDragEnter(t),!0}.bind(this),t.ondrop=function(t){return this.props.onDrop&&this.props.onDrop(t,JSON.parse(t.dataTransfer.getData("data")||"{}")),!1}.bind(this)},__onNodeDidMount:function(t){this._nodes[t.getId()]=t},__onNodeDrag:function(){},__onNodeDragEnd:function(t,e,n){var i=this.state.nodes[n.props.index];i&&(i.x=e.currX,i.y=e.currY,this.props.onNodeDragEnd&&this.props.onNodeDragEnd(t,e,n))},__onLinkDidMount:function(t){var e=this._nodes[t.props.target],n=this._nodes[t.props.source];this._links[t.getId()]=t,t.setTarget(e),t.setSource(n),t.reset()},getData:function(){return{nodes:this.state.nodes,links:this.state.links}},setData:function(t){if(t){var e={};t.nodes&&(e.nodes=t.nodes),t.links&&(e.links=t.links),Object.keys(e).length&&(this._nodes={},this._links={},this.setState(e))}return this},addLink:function(t,e){this.state.links.push({target:t,source:e}),this.forceUpdate()},deleteLink:function(t){this.state.links.splice(this.state.links.indexOf(t),1),this.forceUpdate()},updateNode:function(t){this.state.nodes.map((function(e,n){return t===e?t:e})),this.forceUpdate()},addNode:function(t,e){t.id=zn.uuid(),this.state.nodes.push(t),e&&this.state.links.push({target:t.id,source:e.getId()}),this.forceUpdate()},deleteNodeById:function(t){var e=null;this.state.nodes=this.state.nodes.filter((function(n,i){return n.id!==t||(e=n.id,!1)})),e&&(this.state.links=this.state.links.filter((function(t,n){return t.source!=e&&t.target!=e}))),this.forceUpdate()},updateNodeById:function(t,e){this.state.nodes.forEach((function(n,i){n.id===t&&zn.extend(n,e)})),this.forceUpdate()},deleteNode:function(t){this.state.nodes.splice(this.state.nodes.indexOf(t),1),this.forceUpdate()},filterNode:function(t){this.setState({nodes:this.state.nodes.filter(t||function(){})})},searchNode:function(t){this.__nodes||(this.__nodes=this.state.nodes.slice(0)),this.setState({nodes:this.__nodes.filter(t)})},__onNodeClick:function(t,e,n){this.setState({selectNode:n}),this.props.onNodeClick&&this.props.onNodeClick(t,e,n,this)},render:function(){return s.createElement("div",{className:znui.react.classname("zr-graph-flow-canvas",this.props.className),style:this.props.style},(this.state.nodes||[]).map(function(t,e){var n=this;return t.id=t.id||zn.uuid(),s.createElement(r,i({},t,{key:t.id,index:e,canvas:this,className:this.props.nodeClassName,selected:this.state.selectNode===t,editable:this.props.editable||t.editable,draggable:this.props.draggable||t.draggable,render:this.props.nodeRender,onContextMenu:this.props.onNodeContextMenu,onNodeEditDragEnd:this.props.onNodeEditDragEnd,onNodeDidMount:this.__onNodeDidMount,onNodeDrag:this.__onNodeDrag,onNodeDragEnd:this.__onNodeDragEnd,onClick:function(e,i){return n.__onNodeClick(e,i,t)}}))}.bind(this)),this.state.links.map(function(t,e){return t.id=t.id||zn.uuid(),s.createElement(a,i({},t,{key:t.id,render:this.props.linkRender,onLinkDidMount:this.__onLinkDidMount}))}.bind(this)),s.createElement(a,{ref:"temp"}))}})},function(t,e){!function(){t.exports=this.ReactDOM}()}]));