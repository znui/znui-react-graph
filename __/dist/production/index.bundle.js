(function(t,e){for(var n in e)t[n]=e[n]})(this,function(n){var i={};function s(t){if(i[t]){return i[t].exports}var e=i[t]={i:t,l:false,exports:{}};n[t].call(e.exports,e,e.exports,s);e.l=true;return e.exports}s.m=n;s.c=i;s.d=function(t,e,n){if(!s.o(t,e)){Object.defineProperty(t,e,{enumerable:true,get:n})}};s.r=function(t){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(t,"__esModule",{value:true})};s.t=function(e,t){if(t&1)e=s(e);if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var n=Object.create(null);s.r(n);Object.defineProperty(n,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n};s.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};s.d(t,"a",t);return t};s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};s.p="";return s(s.s=3)}([function(t,e){(function(){t.exports=this["React"]})()},function(t,e,n){var i=znui.React||n(0);t.exports=i.createClass({displayName:"Link",getDefaultProps:function t(){return{highLightStyle:{stroke:"#f0ad4e",strokeWidth:"1px"},lineStyle:{stroke:"#E26965",strokeWidth:"1px"}}},getInitialState:function t(){return{uuid:this.props.id||zn.uuid(),x1:0,y1:0,x2:0,y2:0,marker:"",lineStyle:this.props.lineStyle,svgStyle:{},zIndex:0}},componentDidMount:function t(){this.highLight(false);this.props.onLinkDidMount&&this.props.onLinkDidMount(this)},setTarget:function t(e){if(e){this._target=e;e.setLink(this.state.uuid,this)}},setSource:function t(e){if(e){this._source=e;e.setLink(this.state.uuid,this)}},getId:function t(){return this.state.uuid},reset:function t(e,n){var i=this.__calculateSVGBound(e,n);if(i){if(i.left==0&&i.top==0){i.width=0;i.height=0}this.setState({svgStyle:i})}},__getDirection:function t(e,n,i,s){var r=0;var e=e-i<=0?e:i;var n=n-s<=0?n:s;if(e!=i&&n!=s){r=1}if(e==i&&n!=s){r=2}if(e==i&&n==s){r=3}if(e!=i&&n==s){r=4}return r},highLight:function t(e){var n={};if(e){n=this.props.highLightStyle}else{n=this.props.lineStyle}this._highLight=e;this.setState({lineStyle:n})},__calculateSVGBound:function t(e,n){var i=e||!!this._target&&this._target.getCenterXY();var s=n||!!this._source&&this._source.getCenterXY();if(!i||!s){return}var r=this.props.minSize||2,o=this.__getDirection(i.x,i.y,s.x,s.y);var a=0,d=0,h=0,u=0;var c=0,p=0,l=0,f=0;switch(o){case 1:a=i.x;d=i.y;h=s.x-i.x;u=s.y-i.y;h<r&&(h=r);u<r&&(u=r);c=0;p=0;l=h;f=u;break;case 2:a=s.x;d=i.y;h=i.x-s.x;u=s.y-i.y;h<r&&(h=r);u<r&&(u=r);c=0;p=u;l=h;f=0;break;case 3:a=s.x;d=s.y;h=i.x-s.x;u=i.y-s.y;h<r&&(h=r);u<r&&(u=r);c=0;p=0;l=h;f=u;break;case 4:a=i.x;d=s.y;h=s.x-i.x;u=i.y-s.y;h<r&&(h=r);u<r&&(u=r);c=0;p=u;l=h;f=0;break}this.setState({x1:c,y1:p,x2:l,y2:f});return{left:a,top:d,width:h,height:u}},drawLineArrow:function t(e,n,i,s){var r;var o,a,d;var h=10;var u,c;o=Math.atan2(n-s,e-i);a=Math.cos(o);d=Math.sin(o);r="M"+e+","+n+" L"+i+","+s;u=(Number(e)+Number(i))/2;c=(Number(n)+Number(s))/2;r+=" M"+u+","+c;r+=" L"+(Number(u)+Number(h*a-h/2*d))+","+(Number(c)+Number(h*d+h/2*a));r+=" M"+(Number(u)+Number(h*a+h/2*d)+","+(Number(c)-Number(h/2*a-h*d)));r+=" L"+u+","+c;return r},render:function t(){return i.createElement("svg",{className:"zr-graph-link",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:this.state.svgStyle},i.createElement("defs",null,i.createElement("marker",{id:"Triangle",markerWidth:"20",markerHeight:"20",refX:"0",refY:"4",orient:"auto",markerUnits:"strokeWidth",viewBox:"0 0 50 50"},i.createElement("path",{d:"M0,0 L0,6 L9,3 z",fill:"#f00"}))),i.createElement("line",{className:"line",markerStart:"url(#Triangle)",x1:this.state.x1,y1:this.state.y1,x2:this.state.x2,y2:this.state.y2,style:this.state.lineStyle}))}})},function(t,e,n){var s=znui.React||n(0);var i=n(1);t.exports=s.createClass({displayName:"Node",getDefaultProps:function t(){return{draggable:true,editable:true,data:{},x:0,y:0}},getInitialState:function t(){this._links={};this._nodes={};return{uuid:this.props.id||zn.uuid(),highLight:false}},componentDidMount:function t(){var e=this._dom,n=this;this._x=this.props.x;this._y=this.props.y;this._parentPosition=zn.dom.getPosition(this._dom.parentNode);if(this.props.draggable){zn.draggable.create(e,{start:[this.props.x,this.props.y],onDragStart:this.__onNodeDragStart,onDrag:this.__onNodeDrag,onDragEnd:this.__onNodeDragEnd})}zn.dom.on(e,"mouseover",this.__onMouseOver);zn.dom.on(e,"mouseout",this.__onMouseOut);this.props.onNodeDidMount&&this.props.onNodeDidMount(this)},getCenterXY:function t(){var e=zn.dom.getPosition(this._dom);var n=e.width/2,i=e.height/2,s=0,r=0;if(!this.props.draggable){s=e.x-this._parentPosition.x+n;r=e.y-this._parentPosition.y+i}else{s=this._x+n;r=this._y+i;if(this.props.parent){s=s+this.props.parent._x;r=r+this.props.parent._y}}return{x:s,y:r}},setLink:function t(e,n){this._links[e]=n},getLink:function t(e){return this._links[e]},deleteLink:function t(e){this._links[e]=null;delete this._links[e]},setNode:function t(e,n){this._nodes[e]=n},addNode:function t(e){var n=null,i;if(e){n=s.createElement(Node,e);this._nodes[n.state.uuid]=n;s.render(n,this._dom)}},__onNodeDragStart:function t(e,n){var i=this._dom;this._oldZIndex=i.style.zIndex;i.style.zIndex=10;this._startVector={x:n.mouseX,y:n.mouseY};if(e.target.className.indexOf("manual-connect")!=-1){return this.__createLine(e,n),false}},__createLine:function t(e,n){if(!this._dragTemp){var s=this;var r=this._dragTemp=document.createElement("div");r.className="zr-graph-node-line-temp";zn.dom.setStyles(this._dragTemp,{width:8,height:8,borderRadius:5,backgroundColor:"#800010"});var o=this.getCenterXY(),i=zn.dom.getPosition(e.target),a=this._parentPosition;var d=this.props.canvas.refs.temp;zn.draggable.create(this._dragTemp,{event:e,start:[i.x,i.y],onDragStart:function t(e,n){},onDrag:function t(e,n){var i=zn.dom.getPosition(r);d.reset(o,{x:i.x-a.x,y:i.y-a.y})},onDragEnd:function t(e,n){s.clearTempLink();var i=s.findNode.call(s,document.elementFromPoint(n.mouseX,n.mouseY));if(i){if(i!==s.getId()){s.props.canvas.addLink(s.getId(),i)}}else{s.props.onNodeEditDragEnd&&s.props.onNodeEditDragEnd(s,n)}}});document.body.appendChild(this._dragTemp)}},findNode:function t(e){if(!e||e===document.body){return}var n=e.className;if(!n){return this.findNode(e.parentNode)}if(n=="zr-graph-flow-canvas"){return}if(!n.indexOf){return}if(n.indexOf("zr-node")!==-1){return e.getAttribute("data-id")}else{return this.findNode(e.parentNode)}},clearTempLink:function t(){if(this._dragTemp){document.body.removeChild(this._dragTemp);this._dragTemp=null}this.props.canvas.refs.temp.reset({x:0,y:0},{x:0,y:0})},__onConnectMouseUp:function t(){this.clearTempLink()},__onNodeDragEnd:function t(e,n){var i=Math.abs(this._startVector.x-n.mouseX),s=Math.abs(this._startVector.y-n.mouseY);if(this._dom){this._dom.style.zIndex=this._oldZIndex}if(i<5&&s<5){this.props.onClick&&this.props.onClick(e,this);return false}this.props.onNodeDragEnd&&this.props.onNodeDragEnd(e,n,this)},__onNodeDrag:function t(e,n){this._x=n.currX;this._y=n.currY;this.__onLinkReset();this.__scanChild();!!this.onNodeDrag&&this.onNodeDrag(e,n)},__onLinkReset:function t(){var e=this._links;for(var n in e){e[n].reset()}},__scanChild:function t(){var e=this._nodes;for(var n in e){e[n].__onLinkReset()}},highLight:function t(e){this.setState({highLight:e!==undefined?e:true})},__onMouseOver:function t(e){for(var n in this._links){this._links[n].highLight(true)}},__onMouseOut:function t(e){for(var n in this._links){this._links[n].highLight(false)}this.setState({highLight:false})},__editableRender:function t(){if(this.props.editable){return s.createElement("i",{className:"manual-connect",onMouseUp:this.__onConnectMouseUp})}},__onContextMenu:function t(e){e.stopPropagation();return this.props.onContextMenu&&this.props.onContextMenu(e,this)},getId:function t(){return this.state.uuid},render:function t(){var n=this;return s.createElement("div",{ref:function t(e){return n._dom=e},style:this.props.style,className:znui.react.classname("zr-graph-node",this.props.className),"data-id":this.getId(),"data-highlight":this.state.highLight,"data-selected":this.props.selected,onContextMenu:this.__onContextMenu},this.props.render&&this.props.render(this.props.data,this),this.__editableRender())}})},function(t,e,n){t.exports={Node:n(2),Link:n(1),FlowCanvas:n(4)}},function(t,e,n){function r(){r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){t[i]=n[i]}}}return t};return r.apply(this,arguments)}var o=znui.React||n(0);var i=znui.ReactDOM||n(5);var a=n(2);var s=n(1);t.exports=o.createClass({displayName:"FlowCanvas",getInitialState:function t(){return{nodes:[],links:[]}},componentDidMount:function t(){this._dom=i.findDOMNode(this);this.setData(this.props.data);this.__initDragDrop(this._dom)},componentDidUpdate:function t(e,n){if(e.data!=this.props.data){this.setData(this.props.data)}},__initDragDrop:function t(e){e.ondragover=function(t){t.preventDefault();this.props.onDragOver&&this.props.onDragOver(t);return true}.bind(this);e.ondragenter=function(t){this.props.onDragEnter&&this.props.onDragEnter(t);return true}.bind(this);e.ondrop=function(t){this.props.onDrop&&this.props.onDrop(t,JSON.parse(t.dataTransfer.getData("data")||"{}"));return false}.bind(this)},__onNodeDidMount:function t(e){this._nodes[e.getId()]=e},__onNodeDrag:function t(){},__onNodeDragEnd:function t(e,n,i){var s=this.state.nodes[i.props.index];if(s){s.x=n.currX;s.y=n.currY;this.props.onNodeDragEnd&&this.props.onNodeDragEnd(e,n,i)}},__onLinkDidMount:function t(e){var n=this._nodes[e.props.target],i=this._nodes[e.props.source];this._links[e.getId()]=e;e.setTarget(n);e.setSource(i);e.reset()},getData:function t(){return{nodes:this.state.nodes,links:this.state.links}},setData:function t(e){if(e){var n={};if(e.nodes){n.nodes=e.nodes}if(e.links){n.links=e.links}if(Object.keys(n).length){this._nodes={};this._links={};this.setState(n)}}return this},addLink:function t(e,n){this.state.links.push({target:e,source:n});this.forceUpdate()},deleteLink:function t(e){this.state.links.splice(this.state.links.indexOf(e),1);this.forceUpdate()},updateNode:function t(n){this.state.nodes.map(function(t,e){if(n===t){return n}return t});this.forceUpdate()},addNode:function t(e,n){e.id=zn.uuid();this.state.nodes.push(e);if(n){this.state.links.push({target:e.id,source:n.getId()})}this.forceUpdate()},deleteNodeById:function t(n){var i=null;this.state.nodes=this.state.nodes.filter(function(t,e){if(t.id!==n){return true}else{i=t.id;return false}});if(i){this.state.links=this.state.links.filter(function(t,e){if(t.source==i||t.target==i){return false}else{return true}})}this.forceUpdate()},updateNodeById:function t(n,i){this.state.nodes.forEach(function(t,e){if(t.id===n){zn.extend(t,i)}});this.forceUpdate()},deleteNode:function t(e){this.state.nodes.splice(this.state.nodes.indexOf(e),1);this.forceUpdate()},filterNode:function t(e){this.setState({nodes:this.state.nodes.filter(e||function(){})})},searchNode:function t(e){if(!this.__nodes){this.__nodes=this.state.nodes.slice(0)}this.setState({nodes:this.__nodes.filter(e)})},__onNodeClick:function t(e,n,i){this.setState({selectNode:i});this.props.onNodeClick&&this.props.onNodeClick(e,n,i,this)},render:function t(){zn.debug("FlowCanvas data: ",this.state);return o.createElement("div",{className:znui.react.classname("zr-graph-flow-canvas",this.props.className),style:this.props.style},(this.state.nodes||[]).map(function(i,t){var s=this;i.id=i.id||zn.uuid();return o.createElement(a,r({},i,{key:i.id,index:t,canvas:this,className:this.props.nodeClassName,selected:this.state.selectNode===i?true:false,editable:this.props.editable||i.editable,draggable:this.props.draggable||i.draggable,render:this.props.nodeRender,onContextMenu:this.props.onNodeContextMenu,onNodeEditDragEnd:this.props.onNodeEditDragEnd,onNodeDidMount:this.__onNodeDidMount,onNodeDrag:this.__onNodeDrag,onNodeDragEnd:this.__onNodeDragEnd,onClick:function t(e,n){return s.__onNodeClick(e,n,i)}}))}.bind(this)),this.state.links.map(function(t,e){t.id=t.id||zn.uuid();return o.createElement(s,r({},t,{key:t.id,render:this.props.linkRender,onLinkDidMount:this.__onLinkDidMount}))}.bind(this)),o.createElement(s,{ref:"temp"}))}})},function(t,e){(function(){t.exports=this["ReactDOM"]})()}]));